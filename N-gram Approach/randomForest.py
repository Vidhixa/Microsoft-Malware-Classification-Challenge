from sklearn.ensemble import RandomForestClassifier
import pandas as pd
import csv

def readData(filename):
	
	f = open(filename,'rb')
	reader = csv.reader(f)
	header = reader.next()
	columns = {}
	for h in header:
	     columns[h] = []
	for row in reader:
		for h,v in zip(header,row):
			columns[h].append(v)
	f.close()
	df = pd.DataFrame(columns, columns=header)
	print len(df)
	return df


trainedData = readData('suhas/mergeTrain.csv')
labels = trainedData['classLabel']
del trainedData['classLabel']
if 'filename' in trainedData:
	del trainedData['filename']
rfClassifier = RandomForestClassifier(n_estimators=150, min_samples_split=2, n_jobs=-1)
print('fitting the model')
rfClassifier.fit(trainedData, labels)
testData = readData('suhas/mergeTest.csv')
#del testData['']
testFileNames = []
if 'filename' in testData:
	testFileNames = testData['filename']
	del testData['filename']
predicted_probs = rfClassifier.predict_proba(testData)
count = 0
f = open("Solution.csv","w")
for arr in predicted_probs:
	row=[]
	for val in arr:
	    row.append(val)
	for i in range(0,len(row)):
		f.write(str(row[i]))		
	    	#if(i!=len(row)-1):
		f.write(",")
	f.write(testFileNames[count])		
	f.write("\n")
	count+=1
f.close()
print(count)		
	
	
