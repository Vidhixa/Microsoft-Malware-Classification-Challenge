library(randomForest)
library(caret)

splitdf <- function(dataframe, seed=NULL) 
{
	if (!is.null(seed)) set.seed(seed)
	index <- 1:nrow(dataframe)
	trainindex <- sample(index, trunc(length(index)*9/10))
	trainset <- dataframe[trainindex, ]
	testset <- dataframe[-trainindex, ]
	list(trainset=trainset,testset=testset)
}

RFOUT<-function(trainASMPath,trainBYTEPath,testASMPath,testBYTEPath,testListPath)
{
	trainASMData<-read.csv(trainASMPath)
	classes<-trainASMData$class	

	trainASMData$fileName<-NULL
	trainASMData$class<-NULL

	corASM<-cor(trainASMData)
	highCorASM<-findCorrelation(corASM,0.7)
	trainASMData<-trainASMData[,-highCorASM]

	trainASMData$class<-classes
	
	rfASM<-vector("list",10)
	for(i in  1:10)
	{
		tempASMData<- trainASMData[sample(nrow(trainASMData),dim(trainASMData)[1]*3/10),]
		rfASM[[i]] = randomForest(as.factor(class) ~ .,data = tempASMData,importance = TRUE,proximity = TRUE,type = classification)
	}

	trainBYTEData<-read.csv(trainBYTEPath)
	classes<-trainBYTEData$class

	trainBYTEData$fileName<-NULL
	trainBYTEData$class<-NULL

	corBYTE<-cor(trainBYTEData)
	highCorBYTE<-findCorrelation(corBYTE,0.5)
	trainBYTEData<-trainBYTEData[,-highCorBYTE]

	trainBYTEData$class<-classes
	rfBYTE<-vector("list",10)
	for(i in  1:10)
	{
		tempBYTEData<- trainBYTEData[sample(nrow(trainBYTEData),dim(trainBYTEData)*3[1]/10),]
		rfBYTE[[i]] = randomForest(as.factor(class) ~ .,data = tempBYTEData,importance = TRUE,proximity = TRUE,type = classification)
	}


	testASMData<-read.csv(testASMPath)
	testASMData<-testASMData[,-c(dim(testASMData)[2])]
	testASMData<-testASMData[,-highCorASM]

	testBYTEData<-read.csv(testBYTEPath)
	testBYTEData<-testBYTEData[,-c(dim(testBYTEData)[2])]
	testBYTEData<-testBYTEData[,-highCorBYTE]

	testList<-read.csv(testListPath)
	
	sink("RF.txt",append= FALSE)
	for(i in 1:dim(testList)[1])
	{
		asmData<-subset(testASMData,as.character(testASMData$fileName)==as.character(testList[i,1]))
		byteData<-subset(testBYTEData,as.character(testBYTEData$fileName)==as.character(testList[i,1]))
				
		asmClassPrediction<-vector("numeric",9)
		if(dim(asmData)[1] != 0)
		{
			asmData$fileName<-NULL
			for(j in 1:10)
			{
				cl<- predict(rfASM[[j]],asmData,type="response",norm.Votes = TRUE,predict.all = FALSE,proximity = FALSE,nodes = FALSE)
				asmClassPrediction[cl]<-asmClassPrediction[cl]+1
			}
		}
		
		byteClassPrediction<-vector("numeric",9)
		if(dim(byteData)[1] != 0)
		{
			byteData$fileName<-NULL
			for(j in 1:10)
			{
				cl<-predict(rfBYTE[[j]],byteData,type="response",norm.Votes = TRUE,predict.all = FALSE,proximity = FALSE,nodes = FALSE)
				byteClassPrediction[cl]<- byteClassPrediction[cl]+1
			}
		}
		
		cat("\"")
		cat(as.character(testList[i,1]))
		cat("\"")
	
		total<-sum(asmClassPrediction)+sum(byteClassPrediction)
		for(j in 1:9)
		{
			cat(",")
			cat((asmClassPrediction[j]+byteClassPrediction[j])/total)
		}
		cat("\n")	
	}
	sink()

	
	#testData<-read.csv(testPath)
	#k<-predict(rf,testData,type="response",norm.Votes = TRUE,predict.all = FALSE,proximity = FALSE,nodes = FALSE)
	#print(k)
	#sink()
}
